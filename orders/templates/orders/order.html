{% extends "orders/base.html" %}

{% block title %}Order{% endblock %}

{% block body %}

  <h1>Order</h1>
  <form
          id="order_form"
          ajax_load_meals="{% url 'ajax_load_meals' %}"
          ajax_load_ingredients="{% url 'ajax_load_ingredients' %}"
          method="post">
    {% csrf_token %}
    <div class="form-group" id="type-select">
      <label for="id_type">What would you like to eat?</label>
      <select class="form-control" name="type" id="id_type">
        {% for type in form.type %}
        {{ type }}
        {% endfor %}
      </select>
    </div>
    <div class="form-group" id="meal-select"></div>
    <div class="form-group" id="ingredients-select"></div>
    <button type="submit" class="btn btn-primary">Submit</button>
  </form>


{% if cart %}
<h1>Cart {{ c_value }}$</h1>
<ul>
{% for i in cart %}
<li>
  <div>
    <h4>{{ i.meal.name }} {{ i.total_price }}$</h4>
    {% if i.toppings %}
    <p>toppings:</p>
    <ul>
      {% for t in i.toppings %}
      <li>{{ t.name }}</li>
      {% endfor %}
    </ul>
    {% endif %}
    {% if i.extras %}
    <p>extras:</p>
    <ul>
      {% for e in i.extras %}
      <li>{{ e.name }}</li>
      {% endfor %}
    </ul>
    {% endif %}
  </div>
</li>

{% endfor %}
</ul>
{% else %}
<p>empty cart</p>
{% endif %}

{% endblock %}


{% block scripts %}
  <script>
    $(document).ready(function () {
      $("#order_form")[0].reset()
      });

    $(document).ready(function() {
      $('#id_type').select2()
    });

    $("#id_type").change(function () {

    let ajax_url = $("#order_form").attr("ajax_load_meals");
    let selected_type_id = $(this).val();

    $("#ingredients-select").hide()

    if (selected_type_id) {
      $.ajax({
        url: ajax_url,
        data: {
          'id_type': selected_type_id
        },
        success: function(data) {
          $("#meal-select").html(data);
          $("#meal-select").show()
        }
      });
     } else {
      $("#meal-select").hide()
      }
    });
  </script>
{% endblock %}
